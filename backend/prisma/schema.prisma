generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  role          Role      @default(USER)
  tokenVersion  Int       @default(0)
  
  // Profile fields
  avatar        String?
  bio           String?   @db.Text
  location      String?
  website       String?
  phoneNumber   String?
  dateOfBirth   DateTime?
  
  // Learning progress
  completedProblems Problem[]  @relation("UserCompletedProblems")
  progress     Progress[]
  
  // Timestamps
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@map("users")
}

model Level {
  id          String    @id @default(cuid())
  name        String    // e.g., "I", "L3", "L4"
  order       Int       // For sorting levels
  description String?   @db.Text
  topics      Topic[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("levels")
}

model Topic {
  id          String    @id @default(cuid())
  name        String
  description String?   @db.Text
  content     String?   @db.Text
  order       Int       // For sorting topics within a level
  level       Level     @relation(fields: [levelId], references: [id])
  levelId     String
  problems    Problem[]
  progress    Progress[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("topics")
}

enum ProblemType {
  INFO
  CODING
}

model Problem {
  id          String    @id @default(cuid())
  name        String
  description String?   @db.Text
  difficulty  Difficulty
  required    Boolean   @default(false)
  reqOrder    Int?      // Order number for required problems
  content     String?   @db.Text  // Problem content/description
  solution    String?   @db.Text  // Solution or hints
  problemType ProblemType @default(INFO)  // Type of problem (Info or Coding)
  codeTemplate String?   @db.Text  // Starting code template for coding problems
  testCases   Json?     // Test cases for coding problems
  topic       Topic     @relation(fields: [topicId], references: [id])
  topicId     String
  completedBy User[]    @relation("UserCompletedProblems")
  progress    Progress[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("problems")
}

model Progress {
  id          String    @id @default(cuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  topic       Topic     @relation(fields: [topicId], references: [id])
  topicId     String
  problem     Problem?  @relation(fields: [problemId], references: [id])
  problemId   String?
  status      ProgressStatus @default(NOT_STARTED)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([userId, topicId, problemId])
  @@map("progress")
}

enum Role {
  USER
  ADMIN
  DEVELOPER
}

enum Difficulty {
  EASY_IIII
  EASY_III
  EASY_II
  EASY_I
  MEDIUM
  HARD
}

enum ProgressStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
} 